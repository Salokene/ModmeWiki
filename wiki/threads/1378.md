# Detect a zombie hit
Game Modding | Call of Duty: Black Ops 3 | Scripting

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Thread By: eDeK<br />How i detect a &quot;hit&quot; of zombie?<br /> <br />My idea is &quot;when i get a hit by a zombie, i lose a perk/money&quot;.<br /> <br />This function can help me? I think is something similar (&quot;damage&quot;, amount, attacker, dir, point, mod &quot;) but im lost.<br /> <br />[CODE=php]function playerHurtcheck()<br />{<br />	self endon(&quot;noHealthOverlay&quot;);<br />	<br />	self.hurtAgain = false;<br />	for ( ;; )<br />	{<br />		self waittill( &quot;damage&quot;, amount, attacker, dir, point, mod );<br />		<br />		if(isdefined(attacker) &amp;&amp; isplayer(attacker) &amp;&amp; attacker.team == self.team)<br />		{<br />			continue;<br />		}<br />		<br />		self.hurtAgain = true;<br />		self.damagePoint = point;<br />		self.damageAttacker = attacker;<br />	}<br />}[/CODE]</p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: mathfag<br /> <br /> <br /> <br />[CODE=php]callback::on_spawned( &amp;playerHurtcheck ); //in main<br /><br /><br />function playerHurtcheck() //self = player<br />{<br />	self endon(&quot;noHealthOverlay&quot;);<br />	<br />	self.hurtAgain = false;<br />	for ( ;; )<br />	{<br />		self waittill( &quot;damage&quot;, amount, attacker, dir, point, mod );<br />		<br />		if(isdefined(attacker) &amp;&amp; attacker.team = level.zombie_team)<br />		{<br />			//if it was a zombie do something here<br />		self zm_score::minus_to_player_score(2000);<br />		}<br />		<br />		self.hurtAgain = true;<br />		self.damagePoint = point;<br />		self.damageAttacker = attacker; //idk what you&#39;re trying to do here<br />	}<br />}[/CODE]<br /> <br />Haven&#39;t tested this. No idea if it will work. Don&#39;t even know if waittill damage is a thing for players.</p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: ihmiskeho<br /><blockquote><em>mathfag</em><br />      callback::on_spawned( &amp;playerHurtcheck ); //in main function playerHurtcheck() //self = player { self endon(&quot;noHealthOverlay&quot;); self.hurtAgain = false; for ( ;; ) { self waittill( &quot;damage&quot;, amount, attacker, dir, point, mod ); if(isdefined(attacker) &amp;&amp; attacker.team = level.zombie_team) { //if it was a zombie do something here self zm_score::minus_to_player_score(2000); } self.hurtAgain = true; self.damagePoint = point; self.damageAttacker = attacker; //idk what you&#39;re trying to do here } }   Haven&#39;t tested this. No idea if it will work. Don&#39;t even know if waittill damage is a thing for players.  </blockquote><br /> The function he had is from _zm_playerhealth.gsc so waittill damage is for players also.<br /> <br />For perk losing:<br />[CODE=php]perk = &quot;specialty_perk_name&quot;;		//replace with the perk you want<br />perk_str = perk + &quot;_stop&quot;;<br />self notify( perk_str );<br /><br />/*Perk names:<br />Mule Kick = specialty_additionalprimaryweapon<br />Deathshot = specialty_deadshot<br />Doubletap = specialty_doubletap2<br />Electric Cherry = specialty_electriccherry<br />Jugg = specialty_armorvest<br />Quick Revive = specialty_quickrevive<br />Speed Cola = specialty_fastreload<br />Stamin Up = specialty_staminup<br />Widows Wine = specialty_widowswine<br /><br />Harrys Perks<br />PHD Flopper = specialty_phdflopper<br />Who&#39;s Who = specialty_whoswho<br />Vulture Aid = specialty_vultureaid<br />Tombstone = specialty_tombstone<br />*/[/CODE]<br />If you want the player to lose a random perk, use something like this:<br />[CODE=php]a_perks = self zm_perks::get_perk_array();<br />perk = array::random(a_perks);<br />self notify( perk + &quot;_stop&quot; );[/CODE]</p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: eDeK<br />I delete this line:<br />[CODE=php]if(isdefined(attacker) &amp;&amp; attacker.team = level.zombie_team)[/CODE]<br />and is work well now, but i lose perks/money with any damage (grenades, wunderwaffe, etc, ...) thanks for reply/help.</p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: ihmiskeho<br /><blockquote><em>eDeK</em><br />I delete this line: if(isdefined(attacker) &amp;&amp; attacker.team = level.zombie_team) and is work well now, but i lose perks/money with any damage (grenades, wunderwaffe, etc, ...) thanks for reply/help.</blockquote><br /> Because when you remove that line it doesn&#39;t check if the damage was done by an attacker, it just checks if you&#39;ve been damaged.<br /> <br />This was tested and it works:<br />[CODE=php]function playerHurtcheck()<br />{<br />    n_score_to_take = 2000;  //Change this to the amount of money you want the player to lose!<br />    for ( ;; )<br />    {<br />        self waittill( &quot;damage&quot;, amount, attacker, dir, point, mod );<br />        <br />        if(isdefined(attacker) &amp;&amp; attacker.team != self.team &amp;&amp; !isdefined(attacker.playername))        //Not in the team of player = zombie<br />        {<br />            if(self.score &gt;= n_score_to_take)    //So you don&#39;t take more than the player has<br />            {<br />                self zm_score::minus_to_player_score(n_score_to_take);<br />            }<br />            else<br />            {<br />                self zm_score::minus_to_player_score(self.score);        //If player has less points than should be taken, take all points<br />            }<br />            //Add perk loss stuff here!<br />            <br />        }    <br />    }<br />}[/CODE]</p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: eDeK<br />Works perfect your script, the problem is im doing probably something wrong with the perks.<br /> <br />Compiler Internal Error : Uninitialized local variable &#39;player&#39;<br /> <br />[CODE=php]function playerHurtcheck()<br />{<br />    n_score_to_take = 999999999;  //Change this to the amount of money you want the player to lose!<br />    for ( ;; )<br />    {<br />        self waittill( &quot;damage&quot;, amount, attacker, dir, point, mod );<br />        <br />        if(isdefined(attacker) &amp;&amp; attacker.team != self.team &amp;&amp; !isdefined(attacker.playername))        //Not in the team of player = zombie<br />        {<br />            if(self.score &gt;= n_score_to_take)    <br />//So you don&#39;t take more than the player has<br />            {<br />                self zm_score::minus_to_player_score(n_score_to_take);<br />            }<br />            else<br />            {<br />                self zm_score::minus_to_player_score(self.score);        <br />//If player has less points than should be taken, take all points<br />            }<br />            //Add perk loss stuff here!<br />            perk = &quot;specialty_armorvest&quot;;<br />            perk_str = perk + &quot;_stop&quot;;<br />            player notify( perk_str );<br /><br />            perk = &quot;specialty_fastreload&quot;;<br />            perk_str = perk + &quot;_stop&quot;;<br />            player notify( perk_str );<br /><br />            perk = &quot;specialty_doubletap2&quot;;<br />            perk_str = perk + &quot;_stop&quot;;<br />            player notify( perk_str );<br /><br />            perk = &quot;specialty_staminup&quot;;<br />            perk_str = perk + &quot;_stop&quot;;<br />            player notify( perk_str );<br /><br />            perk = &quot;specialty_deadshot&quot;;<br />            perk_str = perk + &quot;_stop&quot;;<br />            player notify( perk_str );<br /><br />            perk = &quot;specialty_additionalprimaryweapon&quot;;<br />            perk_str = perk + &quot;_stop&quot;;<br />            player notify( perk_str ); <br />            <br />        }    <br />    }<br />}<br />[/CODE]</p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: Abnormal202<br />In this case (though I can&#39;t see it) I assume each player is getting threaded to your playerhurtcheck() function, meaning that in the function the player is stored as <strong>self</strong>.<br /> <br />So whenever you want to use the player, use <strong>self</strong> instead, because we haven&#39;t defined anything as player.<br /> <br />Meaning this:<br />[CODE=php]player notify( perk_str );[/CODE]<br /> <br />should be:<br />[CODE=php]self notify( perk_str );[/CODE]</p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: eDeK<br />Yeah exact, my fault, &quot;player&quot; to &quot;self&quot;, works perfect now, thanks <a href="http://aviacreations.com/modme/index.php?view=forumprofile&uid=1158">&lt;span style=&quot;color:#ffffff;&quot;&gt;mathfag&lt;/span&gt;</a>, <a href="http://aviacreations.com/modme/index.php?view=forumprofile&uid=381">&lt;span style=&quot;color:#ffffff;&quot;&gt;ihmiskeho&lt;/span&gt;</a>, <a href="http://aviacreations.com/modme/index.php?view=forumprofile&uid=260">&lt;span style=&quot;color:#ffffff;&quot;&gt;Abnormal202&lt;/span&gt;</a> for reply/help, really apreciated.<br /> <br />This method can works for 4 players playing at the same time or only work for 1 player?</p>
