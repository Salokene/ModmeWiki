# Perk machines that requires Power from a Gun
Game Modding | Call of Duty: Black Ops 3 | Scripting

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Thread By: Yasser143<br />I would like to know if their is a way to make the perk machines (Not Including Pap) requires the power on and a shot of the wunderwaffe dg-2 on a trigger that turns on the perk machines ( Each Perk machine has its own trigger, each needs to get Shot once from the wunderwaffe).</p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: Ping998<br /><blockquote><em>Yasser143</em>I would like to know if their is a way to make the perk machines (Not Including Pap) requires the power on and a shot of the wunderwaffe dg-2 on a trigger that turns on the perk machines ( Each Perk machine has its own trigger, each needs to get Shot once from the wunderwaffe). </blockquote><br /><br /><p style="text-align:left;"></p><p style="text-align:left;">You could use a trigger_damage and make it weapon specific (I don&#39;t know how to do that in BO3 but it was possible in WaW so I assume it still is).</p><p style="text-align:left;"></p><p style="text-align:left;">Then you could link it to a door (using target/targetname) which would open up to a perk machine or something like that.</p><p style="text-align:left;"></p><p style="text-align:left;">Hope this helps!</p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: natesmithzombies<br /><p style="text-align:left;">Untested (not on a proper PC atm) but here is something to get you started. Let me know if it works out. </p><p style="text-align:left;"></p><p style="text-align:left;">1) Add this to the bottom of your mapname.gsc: </p>[CODE=php]function triggered_perks()<br />{<br />	trigs = GetEntArray( &quot;triggered_perks&quot;, &quot;targetname&quot; ); <br />	foreach( trig in trigs )<br />		trig thread damage_think(); <br />	<br />	thread powered_perk_override(); <br />}<br /><br />function powered_perk_override()<br />{<br />	level flag::wait_till( &quot;start_zombie_round_logic&quot; );<br />	wait(0.1); <br />	<br />	vending_triggers = GetEntArray( &quot;zombie_vending&quot;, &quot;targetname&quot; );<br />	foreach ( trigger in vending_triggers )<br />	{<br />		powered_on = zm_perks::get_perk_machine_start_state(trigger.script_noteworthy);<br />		powered_perk = zm_power::add_powered_item( undefined, undefined, undefined, undefined, undefined, undefined, trigger );<br />		zm_power::remove_powered_item( powered_perk ); <br />	}<br />}<br /><br />function damage_think()<br />{<br />	level endon( &quot;intermission&quot; ); <br />	<br />	while(1)<br />	{<br />		self waittill( &quot;damage&quot;, amount, attacker, direction_vec, point, type, tagName, modelName, partName, weapon, dFlags, inflictor, chargeLevel );<br />		if( weapon == GetWeapon(&quot;tesla_gun&quot;) ) // change tesla_gun to whatever weapon you want<br />		{<br />			str_on = self.script_noteworthy + &quot;_on&quot;;<br />			level notify( str_on ); <br />			break; <br />		}<br />	}<br />}<br />[/CODE]<br /><br /><br /><br /><p style="text-align:left;">2) Add this to your function main of your mapname.gsc: </p>[CODE=php]triggered_perks();<br />[/CODE]<br /><br /><br /><br /><p style="text-align:left;">3) Insert a trigger damage with the following KVPS in your map: </p><p style="text-align:left;">targetname - triggered_perks</p><p style="text-align:left;">script_noteworthy - perk_specific*</p><p style="text-align:left;"></p><p style="text-align:left;">*These are your options for the script_noteworthy: </p>&lt;ul style=&quot;padding-left:40px;margin:0;&quot;&gt;<br />&lt;li style=&quot;width:100%;&quot;&gt;juggernog&lt;/li&gt;&lt;li style=&quot;width:100%;&quot;&gt;widows_wine&lt;/li&gt;&lt;li style=&quot;width:100%;&quot;&gt;doubletap&lt;/li&gt;&lt;li style=&quot;width:100%;&quot;&gt;electric_cherry&lt;/li&gt;&lt;li style=&quot;width:100%;&quot;&gt;revive&lt;/li&gt;&lt;li style=&quot;width:100%;&quot;&gt;marathon&lt;/li&gt;&lt;li style=&quot;width:100%;&quot;&gt;sleight&lt;/li&gt;&lt;/ul&gt;<br /><br /><p style="text-align:left;">4) Compile and report back after testing </p><p style="text-align:left;"></p><p style="text-align:left;">5) If you get an error saying something about unrecognized function add this to your mapname.gsc at the very top: </p>[CODE=php]#using scripts\zm\_zm_power;<br />[/CODE]<br /><br /><br /><br /><p style="text-align:left;"></p><p style="text-align:left;"></p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: Yasser143<br /><p style="text-align:left;">It works, but I dont want the power switch to also turn on the perks as well, only the weapon should be able to. But besides that it works.</p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: natesmithzombies<br /><blockquote><em>Yasser143</em><p style="text-align:left;">It works, but I dont want the power switch to also turn on the perks as well, only the weapon should be able to. But besides that it works.</p></blockquote><p style="text-align:left;">I updated my original code to try and counter this. Reinstall and let me know if it works. I also had to add an additional step 5 in case the _zm_power.gsc is not already used in the mapaname.gsc. If you dont get the error let me know so I can remove that step if it is redundant </p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: Yasser143<br /><blockquote><em>natesmithzombies</em><blockquote><em>Yasser143</em><p style="text-align:left;">It works, but I dont want the power switch to also turn on the perks as well, only the weapon should be able to. But besides that it works.</p></blockquote><p style="text-align:left;">I updated my original code to try and counter this. Reinstall and let me know if it works. I also had to add an additional step 5 in case the _zm_power.gsc is not already used in the mapaname.gsc. If you dont get the error let me know so I can remove that step if it is redundant </p></blockquote><p style="text-align:left;">Even with the addition support of step 5, im getting this error from the script, </p><p style="text-align:left;">Unresolved external &#39;zm_perks::get_perk_machine_start_state</p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: natesmithzombies<br /><blockquote><em>Yasser143</em><blockquote><em>natesmithzombies</em><blockquote><em>Yasser143</em><p style="text-align:left;">It works, but I dont want the power switch to also turn on the perks as well, only the weapon should be able to. But besides that it works.</p></blockquote><p style="text-align:left;">I updated my original code to try and counter this. Reinstall and let me know if it works. I also had to add an additional step 5 in case the _zm_power.gsc is not already used in the mapaname.gsc. If you dont get the error let me know so I can remove that step if it is redundant </p></blockquote><p style="text-align:left;">Even with the addition support of step 5, im getting this error from the script, </p><p style="text-align:left;">Unresolved external &#39;zm_perks::get_perk_machine_start_state</p></blockquote><p style="text-align:left;">Interesting it appears that this must be missing in your mapname.gsc as well: </p>[CODE=php]#using scripts\zm\_zm_perks;<br />[/CODE]<br /><br /><br /><br /><p style="text-align:left;">insert that at the top of the script and see if it compiles. Sorry I am not on a proper computer to test myself atm</p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: Yasser143<br /><p style="text-align:left;">Ya its still is the same as the last script, the dg2 turns on the perks, but the power switch also turns on the perks as well.</p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: natesmithzombies<br /><blockquote><em>Yasser143</em><p style="text-align:left;">Ya its still is the same as the last script, the dg2 turns on the perks, but the power switch also turns on the perks as well.</p></blockquote><p style="text-align:left;">Damn sorry to put this one on hold, but I will revisit this topic after I finish Brutus. I am on a limited time crunch and this one has to be tested on my home PC</p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: Yasser143<br /><p style="text-align:left;">No Problem Nate, just let me know when u have time to finish up this script for me. Thx</p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: Yasser143<br /><p style="text-align:left;">Nate do u have any time on hand to finish up the script?</p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: natesmithzombies<br /><p style="text-align:left;">I have tested this and can assure you that it works: </p><p style="text-align:left;"></p><p style="text-align:left;">Step 1) Paste this at the bottom of your mapname.gsc</p>[CODE=php]function triggered_perks()<br />{<br />	zm_perks::register_perk_machine_power_override( &quot;specialty_armorvest&quot;, &amp;wait_for_trigger ); <br />	zm_perks::register_perk_machine_power_override( &quot;specialty_quickrevive&quot;, &amp;wait_for_trigger ); <br />	zm_perks::register_perk_machine_power_override( &quot;specialty_fastreload&quot;, &amp;wait_for_trigger ); <br />	zm_perks::register_perk_machine_power_override( &quot;specialty_doubletap2&quot;, &amp;wait_for_trigger ); <br />	zm_perks::register_perk_machine_power_override( &quot;specialty_staminup&quot;, &amp;wait_for_trigger ); <br />	zm_perks::register_perk_machine_power_override( &quot;specialty_phdflopper&quot;, &amp;wait_for_trigger ); <br />	zm_perks::register_perk_machine_power_override( &quot;specialty_deadshot&quot;, &amp;wait_for_trigger ); <br />	zm_perks::register_perk_machine_power_override( &quot;specialty_additionalprimaryweapon&quot;, &amp;wait_for_trigger ); <br />	zm_perks::register_perk_machine_power_override( &quot;specialty_electriccherry&quot;, &amp;wait_for_trigger ); <br />	zm_perks::register_perk_machine_power_override( &quot;specialty_widowswine&quot;, &amp;wait_for_trigger ); <br />}<br /><br />function wait_for_trigger()<br />{<br />	if( isDefined( level.run_special_power_once ) ) // make the func run once and only once<br />		return;<br />	level.run_special_power_once = true; <br />	<br />	trigs = GetEntArray( &quot;triggered_perks&quot;, &quot;targetname&quot; ); <br />	foreach( trig in trigs )<br />		trig thread activate_on_shoot(); <br />}<br /><br />function activate_on_shoot()<br />{<br />	while(1)<br />	{<br />		self waittill( &quot;damage&quot;, amount, attacker, direction_vec, point, type, tagName, modelName, partName, weapon, dFlags, inflictor, chargeLevel );<br />		if( weapon == GetWeapon(&quot;tesla_gun&quot;) ) // change tesla_gun to whatever weapon you want<br />		{<br />			perk_machine_think( self.script_noteworthy, level._custom_perks[ self.script_noteworthy ] );<br />			break; <br />		}<br />	}<br />}<br /><br />function perk_machine_think( str_key, s_custom_perk )<br />{	<br />	str_endon = str_key + PERK_END_POWER_THREAD;<br />	level endon( str_endon );//Support endon for any perk machine<br />	<br />	str_on = s_custom_perk.alias + &quot;_on&quot;;<br />	str_off = s_custom_perk.alias + &quot;_off&quot;;<br />	str_notify = str_key + &quot;_power_on&quot;;<br />	<br />	while ( true )<br />	{<br />		machine = getentarray( s_custom_perk.radiant_machine_name, &quot;targetname&quot;);<br />		machine_triggers = GetEntArray( s_custom_perk.radiant_machine_name, &quot;target&quot; );<br />		<br />		for( i = 0; i &lt; machine.size; i++ )<br />			machine<em>SetModel(level.machine_assets[str_key].off_model);<br />		<br />		level thread zm_perks::do_initial_power_off_callback( machine, str_key );<br />		array::thread_all( machine_triggers, &amp;zm_perks::set_power_on, false );<br />	<br />		// level waittill( str_on );<br />	<br />		for( i = 0; i &lt; machine.size; i++ )<br />		{<br />			machine<em>SetModel(level.machine_assets[str_key].on_model);<br />			machine<em>vibrate((0,-100,0), 0.3, 0.4, 3);<br />			machine<em>playsound(&quot;zmb_perks_power_on&quot;);<br />			machine<em>thread zm_perks::perk_fx( s_custom_perk.machine_light_effect );<br />			machine<em>thread zm_perks::play_loop_on_machine();<br />		}<br />		level notify( str_notify );<br />		<br />		array::thread_all( machine_triggers, &amp;zm_perks::set_power_on, true );<br />		if( isdefined( level.machine_assets[ str_key ].power_on_callback ) )<br />		{<br />			array::thread_all( machine, level.machine_assets[ str_key ].power_on_callback );<br />		}<br />		<br />		level waittill( str_off );<br />			<br />		if( isdefined( level.machine_assets[ str_key ].power_off_callback ) )<br />		{<br />			array::thread_all( machine, level.machine_assets[ str_key ].power_off_callback );<br />		}<br />		array::thread_all( machine, &amp;zm_perks::turn_perk_off );<br />	}<br />}<br />[/CODE]<br /><br /><br /><br /><p style="text-align:left;"></p><p style="text-align:left;">Step 2) Add this to the top of your mapname.gsc: </p>[CODE=php]#insert scripts\zm\_zm_perks.gsh;<br />[/CODE]<br /><br /><br /><br /><p style="text-align:left;"></p><p style="text-align:left;">Step 3) Add this to function main in mapname.gsc</p>[CODE=php]level thread triggered_perks();<br />[/CODE]<br /><br /><br /><br /><p style="text-align:left;"></p><p style="text-align:left;">Sep 4) Add a trigger&gt;damage for each perk you would like and give it the following KVPs: </p><p style="text-align:left;">targetname - triggered_perks</p><p style="text-align:left;">script_noteworthy - specialty_name*</p><p style="text-align:left;"></p><p style="text-align:left;">* where specialty name is specialty_armorvest, specialty_quickrevive, etc. </p><p style="text-align:left;"></p><p style="text-align:left;"></p></em></em></em></em></em></em></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: Yasser143<br /><p style="text-align:left;">I get this error when I link it, &#39;zm_perks::register_perk_machine_power_override&#39;</p></p>

---
<strong style="font-size: 1.4em;"><span style="text-decoration: underline;text-decoration-color: #34a7f9;"><span style="color:#34a7f9;">ModmeBot</span></span>:</strong>

<p>Reply By: natesmithzombies<br /><blockquote><em>Yasser143</em><p style="text-align:left;">I get this error when I link it, &#39;zm_perks::register_perk_machine_power_override&#39;</p></blockquote><p style="text-align:left;">Add these to the top of your mapname.gsc</p>[CODE=php]#using scripts\zm\_zm_perks;<br />#insert scripts\zm\_zm_perks.gsh;<br />[/CODE]</p>
